{% extends "base.html" %}

{% block title %}Results{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h2 class="mb-0">Emotion Recognition Results</h2>
                {% if timestamp %}
                <span class="text-light"><i class="fas fa-clock me-1"></i> {{ timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                {% endif %}
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6 text-center">
                        <div class="emotion-result p-4 rounded">
                            <h3 class="mb-3">Detected Emotion</h3>
                            <div class="detected-emotion mb-3">
                                {% if prediction == 'happy' %}
                                    <i class="fas fa-smile-beam emotion-icon text-success"></i>
                                {% elif prediction == 'sad' %}
                                    <i class="fas fa-sad-tear emotion-icon text-info"></i>
                                {% elif prediction == 'angry' %}
                                    <i class="fas fa-angry emotion-icon text-danger"></i>
                                {% elif prediction == 'fear' %}
                                    <i class="fas fa-grimace emotion-icon text-warning"></i>
                                {% elif prediction == 'disgust' %}
                                    <i class="fas fa-dizzy emotion-icon text-muted"></i>
                                {% elif prediction == 'surprise' %}
                                    <i class="fas fa-surprise emotion-icon text-primary"></i>
                                {% else %}
                                    <i class="fas fa-meh emotion-icon text-secondary"></i>
                                {% endif %}
                            </div>
                            <h4 class="emotion-text">{{ prediction|title }}</h4>
                            
                            {% if is_recorded %}
                            <div class="mt-3">
                                <span class="badge bg-info p-2"><i class="fas fa-microphone me-1"></i> Recorded Audio</span>
                            </div>
                            {% elif is_sample %}
                            <div class="mt-3">
                                <span class="badge bg-secondary p-2"><i class="fas fa-music me-1"></i> Sample: {{ sample_name }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h3 class="mb-3 text-center">Confidence Analysis</h3>
                        <div class="chart-container">
                            {% if chart %}
                                <img src="data:image/png;base64,{{ chart }}" alt="Emotion confidence chart" class="img-fluid">
                            {% else %}
                                <div class="alert alert-warning">Chart generation failed</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-12">
                        <h3 class="mb-3 text-center">Audio Visualization</h3>
                        
                        <ul class="nav nav-tabs" id="audioTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="waveform-tab" data-bs-toggle="tab" 
                                        data-bs-target="#waveform" type="button" role="tab" 
                                        aria-controls="waveform" aria-selected="true">
                                    <i class="fas fa-wave-square me-1"></i> Waveform
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="spectrogram-tab" data-bs-toggle="tab" 
                                        data-bs-target="#spectrogram" type="button" role="tab" 
                                        aria-controls="spectrogram" aria-selected="false">
                                    <i class="fas fa-chart-area me-1"></i> Spectrogram
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content p-3 border border-top-0 rounded-bottom" id="audioTabsContent">
                            <div class="tab-pane fade show active" id="waveform" role="tabpanel" aria-labelledby="waveform-tab">
                                <div class="chart-container">
                                    {% if waveform_chart %}
                                        <img src="data:image/png;base64,{{ waveform_chart }}" alt="Audio waveform" class="img-fluid">
                                    {% else %}
                                        <div class="alert alert-warning">Waveform visualization not available</div>
                                    {% endif %}
                                </div>
                                <p class="text-muted mt-2">
                                    <i class="fas fa-info-circle me-1"></i> The waveform shows the amplitude of the sound over time.
                                </p>
                            </div>
                            <div class="tab-pane fade" id="spectrogram" role="tabpanel" aria-labelledby="spectrogram-tab">
                                <div class="chart-container">
                                    {% if spectrogram_chart %}
                                        <img src="data:image/png;base64,{{ spectrogram_chart }}" alt="Audio spectrogram" class="img-fluid">
                                    {% else %}
                                        <div class="alert alert-warning">Spectrogram visualization not available</div>
                                    {% endif %}
                                </div>
                                <p class="text-muted mt-2">
                                    <i class="fas fa-info-circle me-1"></i> The spectrogram shows the spectrum of frequencies as they vary with time.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle me-2"></i>About This Analysis</h5>
                            <p>
                                The system has analyzed the audio using acoustic feature extraction and a deep learning model. 
                                The dominant emotion detected is <strong>{{ prediction }}</strong>.
                            </p>
                            <p>
                                The chart shows the confidence level for each emotion category. Higher values represent greater confidence.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12 d-flex justify-content-center gap-2">
                        <a href="{{ url_for('index') }}" class="btn btn-primary">
                            <i class="fas fa-microphone me-2"></i>Analyze Another Audio
                        </a>
                        <a href="{{ url_for('history') }}" class="btn btn-secondary">
                            <i class="fas fa-history me-2"></i>View History
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Animation for emotion display
    document.addEventListener('DOMContentLoaded', function() {
        const emotionElement = document.querySelector('.detected-emotion');
        emotionElement.classList.add('emotion-animate');
    });
</script>
{% endblock %}
